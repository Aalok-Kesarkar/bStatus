#!/bin/bash

date=$(date)
currentDir=$(pwd)
lastBoot=$(who -b | cut -d " " -f 12-)

netCheck=$(iwconfig)

# For coloured output
green='\033[0;32m'
yellow='\033[0;33m'
blue='\033[0;34m'
cyan='\033[0;36m'
red='\033[0;31m'
clear='\033[0m'

proxyEcho() {
    # $1 is $logicalLocation and $2 is $totalWords
    echo -e "Proxy  IP ---> ${yellow}$(echo $1 | cut -d " " -f 1)${clear}"
    echo -e "Proxy location ---> ${yellow}$(echo $1 | cut -d " " -f 2)${clear}"
    echo -e "Proxy timezone ---> ${yellow}$(echo $1 | cut -d " " -f $2)${clear}"
}

publicIPEcho() {
    # $1 is $wifiEcho and $2 is $ip
    echo -e "${green}wlan0${clear} is connected to ---> ${blue}$1${clear}"
    echo -e "Public IP ---> ${cyan}$2${clear}"
}

basicInfoEcho() {
    # $1 is $userName, $2 is $date, $3 is $currentDir and $4 is $lastBoot
    echo ""
    echo ""
    echo -e "${green}WELCOME BACK $(whoami),${clear}"
    echo "Date ---> $1"
    echo "You are in ---> $2"
    echo "System last booted ---> $3"
    echo ""
}

wlanAdaptorStatus=$(echo "$netCheck" | grep -c wlan0)

# if wlan0 adapter is found live, then...
if [ "$wlanAdaptorStatus" = 1 ]; then
    # check wireless connection status
    routerStatus=$(echo "$netCheck" | grep -c unassociated)

    if [ "$routerStatus" = 0 ]; then
        # Non-proxy public IP address
        ip=$(curl ipinfo.io/ip)
        proxyStatus=$( service tor status | grep -o -c exited )

        if [ "$proxyStatus" = 3 ]; then
            # Get Proxy IP and IP location
            logicalLocation=$(proxychains curl ipinfo.io/geo | grep -e city -e timezone -e ip\" | cut -d "\"" -f 4)
            totalWords=$(echo $logicalLocation | wc -w)
        fi

    else
        echo -e "${red}You are NOT connected to the router${clear}"
    fi

else
    echo -e "${red}wlan0 NOT found, Connect a wireless adapter${clear}"
fi

basicInfoEcho "$date" "$currentDir" "$lastBoot"

if [ "$wlanAdaptorStatus" = 1 ]; then
    if [ "$routerStatus" = 0 ]; then
        wifiSSID=$(echo "$netCheck" | grep ESSID | cut -d "\"" -f 2)
        publicIPEcho "$wifiSSID" "$ip"
        if [ "$proxyStatus" = 3 ]; then
            proxyEcho "$logicalLocation" "$totalWords"
        else
            echo -e "${red}Proxy connection is NOT Active${clear}"
            echo -e "${yellow}start Proxy with -->${clear} ${green}sudo service tor start${clear}"
        fi
    fi
fi
